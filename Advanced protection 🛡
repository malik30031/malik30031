local function sendNotification(text, duration, image, callback)
	local c={} -- قائمة إشعارات
	local ts=game:GetService("TweenService")
	local player=game.Players.LocalPlayer
	local gui=player:WaitForChild("PlayerGui")

	-- صوت الإشعار
	local sound=Instance.new("Sound")
	sound.SoundId="rbxassetid://5515669992"
	sound.Volume=5
	sound.Parent=game:GetService("SoundService")
	sound:Play()
	sound.Ended:Connect(function() sound:Destroy() end)

	-- إنشاء GUI الإشعار
	local notifGui=gui:FindFirstChild("NotificationGui") or Instance.new("ScreenGui")
	notifGui.Name="NotificationGui"
	notifGui.Parent=gui

	local frame=Instance.new("Frame")
	frame.Size=UDim2.new(0,220,0,60)
	frame.Position=UDim2.new(0,-200,0,20)
	frame.BackgroundColor3=Color3.fromRGB(0,0,0)
	frame.BackgroundTransparency=0.2
	frame.BorderSizePixel=1
	frame.BorderColor3=Color3.fromRGB(128,128,128)
	frame.ClipsDescendants=true
	frame.Parent=notifGui
	Instance.new("UICorner",frame).CornerRadius=UDim.new(0,19)

	local label=Instance.new("TextLabel")
	label.Size=UDim2.new(1,0,1,0)
	label.Text=text
	label.TextColor3=Color3.fromRGB(255,255,255)
	label.TextSize=13
	label.TextWrapped=true
	label.BackgroundTransparency=1
	label.Font=Enum.Font.GothamBold
	label.Parent=frame

	local bar=Instance.new("Frame")
	bar.Size=UDim2.new(1,0,0.1,0)
	bar.Position=UDim2.new(0,9,0.8,0)
	bar.BackgroundColor3=Color3.fromRGB(0,170,255)
	bar.BorderSizePixel=0
	bar.Parent=frame
	Instance.new("UICorner",bar).CornerRadius=UDim.new(0,5)

	local icon=Instance.new("ImageLabel")
	icon.Size=UDim2.new(0,20,0,20)
	icon.Position=UDim2.new(1,-213,0,5)
	icon.BackgroundTransparency=1
	icon.Image=image
	icon.Parent=frame

	-- حركة الدخول
	ts:Create(frame,TweenInfo.new(0.5,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{Position=UDim2.new(0,20,0,20)}):Play()
	ts:Create(bar,TweenInfo.new(duration,Enum.EasingStyle.Linear,Enum.EasingDirection.Out),{Size=UDim2.new(0,0,0.1,0)}):Play()

	-- دالة الإغلاق
	local function close()
		local exitTween=ts:Create(frame,TweenInfo.new(0.5,Enum.EasingStyle.Quad,Enum.EasingDirection.In),{Position=UDim2.new(0,-200,0,frame.Position.Y.Offset)})
		exitTween:Play()
		exitTween.Completed:Wait()
		frame:Destroy()
		if callback then callback() end -- هنا يبدأ سكربت الحماية بعد اختفاء الإشعار
	end

	-- إغلاق تلقائي بعد المدة
	task.spawn(function()
		task.wait(duration)
		close()
	end)
end

-- ================= تشغيل الإشعار أولاً =================
sendNotification(
	"تـم إعـاده تطـوير السـکربـت مـن قِبـل / MALIK30031 ", 
	5, -- مدة الإشعار 5 ثوانٍ
	"rbxassetid://132036502772790", 
	function()
		-- ================= هنا يبدأ سكربت الحماية =================
		-- ضع كامل سكربت الحماية هنا بعد هذا السطر
		print("تم بدء سكربت الحماية!") -- مثال، استبدله بالسكربت الكامل
	end
)

task.wait(5)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local SoundService = game:GetService("SoundService")

local LocalPlayer = Players.LocalPlayer
local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

-- دالة تشغيل الصوت
local function playSound(id)
	local s = Instance.new("Sound")
	s.SoundId = "rbxassetid://" .. id
	s.Parent = SoundService
	s:Play()
	s.Ended:Connect(function() s:Destroy() end)
end

-- ================= GUI رئيسي =================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SuperRingPartsGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0,180,0,360)
MainFrame.Position = UDim2.new(0.5,-90,0.5,-180)
MainFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0,15)

-- ================= تحريك GUI =================
local dragging, dragStart, startPos
local function updateDrag(input)
	local delta = input.Position - dragStart
	MainFrame.Position = UDim2.new(
		startPos.X.Scale,
		startPos.X.Offset + delta.X,
		startPos.Y.Scale,
		startPos.Y.Offset + delta.Y
	)
end

MainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1
	or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = MainFrame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)

MainFrame.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement
	or input.UserInputType == Enum.UserInputType.Touch) then
		updateDrag(input)
	end
end)

-- ================= UIStroke متحرك =================
local UIStroke = Instance.new("UIStroke", MainFrame)
UIStroke.Color = Color3.fromRGB(0,170,255)
UIStroke.Thickness = 4
UIStroke.Transparency = 0.2
local dir = 1
RunService.Heartbeat:Connect(function(dt)
	if UIStroke.Thickness >= 5 then dir = -1
	elseif UIStroke.Thickness <= 2 then dir = 1 end
	UIStroke.Thickness += dir * dt * 2
end)

-- ================= عنوان =================
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1,0,0,30)
Title.Text = "حـمايـة متـقـدمـة"
Title.TextColor3 = Color3.fromRGB(0,170,255)
Title.BackgroundColor3 = Color3.fromRGB(0,0,0)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 16
Instance.new("UICorner", Title)

-- ====== الخط الأول تحت العنوان ======
local Line1 = Instance.new("Frame", MainFrame)
Line1.Size = UDim2.new(0.5,0,0,2)
Line1.Position = UDim2.new(0.25,0,0,30)
Line1.BackgroundColor3 = Color3.fromRGB(0,170,255)
Line1.BorderSizePixel = 0
Instance.new("UICorner", Line1).CornerRadius = UDim.new(0,1)

-- ================= زر تصغير =================
local MinimizeButton = Instance.new("TextButton", MainFrame)
MinimizeButton.Size = UDim2.new(0,20,0,20)
MinimizeButton.Position = UDim2.new(1,-25,0,5)
MinimizeButton.Text = "-"
MinimizeButton.BackgroundColor3 = Color3.fromRGB(205,84,75)
MinimizeButton.TextColor3 = MinimizeButton.BackgroundColor3
MinimizeButton.Font = Enum.Font.SourceSansBold
MinimizeButton.TextSize = 14
Instance.new("UICorner", MinimizeButton)

local minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
	minimized = not minimized
	MainFrame:TweenSize(
		minimized and UDim2.new(0,180,0,30) or UDim2.new(0,180,0,360),
		"Out","Quad",0.3,true
	)
	MinimizeButton.Text = minimized and "+" or "-"
	for _,v in pairs(MainFrame:GetChildren()) do
		if v:IsA("TextButton") and v ~= MinimizeButton then
			v.Visible = not minimized
		end
	end
	playSound("12221967")
end)

-- ================= دالة إنشاء الأزرار =================
local function createButton(text, posY)
	local btn = Instance.new("TextButton", MainFrame)
	btn.Size = UDim2.new(0.8,0,0,30)
	btn.Position = UDim2.new(0.1,0,posY,0)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(0,170,255)
	btn.TextColor3 = Color3.new(0,0,0)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 14
	Instance.new("UICorner", btn)
	btn.MouseEnter:Connect(function() btn:TweenSize(UDim2.new(0.85,0,0,32),"Out","Quad",0.2,true) end)
	btn.MouseLeave:Connect(function() btn:TweenSize(UDim2.new(0.8,0,0,30),"Out","Quad",0.2,true) end)
	return btn
end

-- ================= أزرار =================
local ToggleNoClip = createButton("مانـع فلـنق | OFF",0.12)
local ToggleSeat = createButton("مانـع جلـوس | OFF",0.22)
local ToggleAntiBang = createButton("مانـع بانـق | OFF",0.32)
local ToggleReverseBang = createButton("بانـق عکـسي | OFF",0.42)
local ToggleNoSuck = createButton("مانـع مـص | OFF",0.52)
local ToggleReverseSuck = createButton("مـص عكـسي | OFF",0.62)
local ToggleNoGrind = createButton("مانـع جلـخ | OFF",0.72)

-- ====== الخط الثاني ======
local Line2 = Instance.new("Frame", MainFrame)
Line2.Size = UDim2.new(0.5,0,0,2)
Line2.Position = UDim2.new(0.25,0,0.84,0)
Line2.BackgroundColor3 = Color3.fromRGB(0,170,255)
Line2.BorderSizePixel = 0
Instance.new("UICorner", Line2).CornerRadius = UDim.new(0,1)

-- ================= الوظائف الأساسية =================
-- NoClip
local noclipEnabled = false
local noclipConn
local function applyNoClip(state)
	for _,p in pairs(workspace:GetDescendants()) do
		if p:IsA("BasePart") and not p:IsDescendantOf(character) and not p.Anchored then
			pcall(function() p.CanCollide = not state end)
		end
	end
end

ToggleNoClip.MouseButton1Click:Connect(function()
	noclipEnabled = not noclipEnabled
	ToggleNoClip.Text = "مانـع فلـنق | "..(noclipEnabled and "ON" or "OFF")
	ToggleNoClip.BackgroundColor3 = noclipEnabled and Color3.fromRGB(160,60,60) or Color3.fromRGB(0,170,255)
	applyNoClip(noclipEnabled)
	if noclipEnabled then
		if noclipConn then noclipConn:Disconnect() end
		noclipConn = workspace.DescendantAdded:Connect(function(o)
			if o:IsA("BasePart") and not o:IsDescendantOf(character) and not o.Anchored then
				o.CanCollide = false
			end
		end)
	elseif noclipConn then noclipConn:Disconnect() end
	playSound("12221967")
end)

-- AntiSit
-- ================= Anti Sit HARDCORE =================

local antiSitEnabled = false
local antiSitConns = {}

-- تأكيد الحصول على الشخصية
local function getCharacter()
	character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	humanoid = character:WaitForChild("Humanoid")
	root = character:WaitForChild("HumanoidRootPart")
end
getCharacter()

-- ================= تفعيل مانع الجلوس =================
local function enableAntiSit()
	if antiSitEnabled == false then return end
	if not humanoid or humanoid.Health <= 0 then return end

	-- منع حالة الجلوس نهائيًا
	humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, false)
	humanoid:SetStateEnabled(Enum.HumanoidStateType.GettingUp, false)

	-- منع خاصية Sit
	table.insert(antiSitConns,
		humanoid:GetPropertyChangedSignal("Sit"):Connect(function()
			if antiSitEnabled then
				humanoid.Sit = false
			end
		end)
	)

	-- منع التحول إلى Seated
	table.insert(antiSitConns,
		humanoid.StateChanged:Connect(function(_, new)
			if antiSitEnabled and new == Enum.HumanoidStateType.Seated then
				humanoid:ChangeState(Enum.HumanoidStateType.Running)
			end
		end)
	)

	-- تدمير SeatWeld قبل الفيزياء
	table.insert(antiSitConns,
		RunService.Stepped:Connect(function()
			if not antiSitEnabled then return end
			if root and root:FindFirstChild("SeatWeld") then
				root.SeatWeld:Destroy()
			end
			if humanoid.Sit then
				humanoid.Sit = false
			end
		end)
	)

	-- تعطيل جميع الكراسي
	for _, v in ipairs(workspace:GetDescendants()) do
		if v:IsA("Seat") or v:IsA("VehicleSeat") then
			v.Disabled = true
			v.CanTouch = false
		end
	end

	table.insert(antiSitConns,
		workspace.DescendantAdded:Connect(function(v)
			if antiSitEnabled and (v:IsA("Seat") or v:IsA("VehicleSeat")) then
				v.Disabled = true
				v.CanTouch = false
			end
		end)
	)
end

-- ================= إيقاف مانع الجلوس =================
local function disableAntiSit()
	for _, c in ipairs(antiSitConns) do
		pcall(function() c:Disconnect() end)
	end
	antiSitConns = {}

	if humanoid then
		humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, true)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.GettingUp, true)
	end

	for _, v in ipairs(workspace:GetDescendants()) do
		if v:IsA("Seat") or v:IsA("VehicleSeat") then
			v.Disabled = false
			v.CanTouch = true
		end
	end
end

-- ================= ربطه بزر GUI =================
ToggleSeat.MouseButton1Click:Connect(function()
	antiSitEnabled = not antiSitEnabled

	ToggleSeat.Text = "مانـع جلـوس | " .. (antiSitEnabled and "ON" or "OFF")
	ToggleSeat.BackgroundColor3 =
		antiSitEnabled and Color3.fromRGB(160,60,60)
		or Color3.fromRGB(0,170,255)

	if antiSitEnabled then
		enableAntiSit()
	else
		disableAntiSit()
	end

	playSound("12221967")
end)

-- ================= إعادة التفعيل بعد الموت =================
LocalPlayer.CharacterAdded:Connect(function()
	task.wait()
	getCharacter()
	if antiSitEnabled then
		enableAntiSit()
	end
end)


-- ===================== مانع بانق بدون اهتزاز =====================
local antiBangOn = false
local antiBangTrack

local function stopAntiBangAnimation()
	if antiBangTrack then
		antiBangTrack:Stop()
		antiBangTrack = nil
	end
end

local function playAntiBangAnimation()
	if not humanoid then return end
	local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)

	local anim = Instance.new("Animation")
	anim.AnimationId = "rbxassetid://117139383441813" -- ضع هنا ID الأنميشن الصحيح
	antiBangTrack = animator:LoadAnimation(anim)
	antiBangTrack.Priority = Enum.AnimationPriority.Action

	-- تشغيل الأنميشن مرة واحدة وتجميده
	antiBangTrack:Play()
	antiBangTrack.TimePosition = 0.5  -- تثبيت الحركة عند منتصف الإطار المطلوب
	antiBangTrack:AdjustSpeed(0)      -- تجميد الأنميشن
end

-- زر AntiBang
ToggleAntiBang.MouseButton1Click:Connect(function()
	antiBangOn = not antiBangOn
	ToggleAntiBang.BackgroundColor3 = antiBangOn and Color3.fromRGB(160,60,60) or Color3.fromRGB(0,170,255)
	ToggleAntiBang.Text = "مانع بانق | " .. (antiBangOn and "ON" or "OFF")

	if antiBangOn then
		playAntiBangAnimation()
	else
		stopAntiBangAnimation()
	end

	playSound("12221967")
end)

-- إعادة تجهيز AntiBang بعد الموت
LocalPlayer.CharacterAdded:Connect(function(c)
	character = c
	humanoid = c:WaitForChild("Humanoid")

	if antiBangOn then
		playAntiBangAnimation()
	end
end)

-- ================= بانق عكسي مع دعم بعد الموت =================
local reverseBangOn = false
local stopFlagReverseBang = {Value=false}
local trackReverseBang

local function loopReverseBangAnimation(track, speed, startTime, freezeTime, stopFlag)
	task.spawn(function()
		while not stopFlag.Value do
			track:Play()
			track:AdjustSpeed(speed)
			track.TimePosition = startTime
			while track.TimePosition < freezeTime and not stopFlag.Value do
				task.wait()
			end
			track.TimePosition = freezeTime
			track:AdjustSpeed(0)
			task.wait(0.1)
		end
		track:Stop()
	end)
end

ToggleReverseBang.MouseButton1Click:Connect(function()
	reverseBangOn = not reverseBangOn
	ToggleReverseBang.BackgroundColor3 = reverseBangOn and Color3.fromRGB(160,60,60) or Color3.fromRGB(0,170,255)
	ToggleReverseBang.Text = "بانـق عكـسي | "..(reverseBangOn and "ON" or "OFF")

	if not humanoid then return end
	if not trackReverseBang then
		local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)
		local anim = Instance.new("Animation")
		anim.AnimationId = "rbxassetid://122458935180603" -- ضع ID الأنميشن الصحيح
		trackReverseBang = animator:LoadAnimation(anim)
		trackReverseBang.Priority = Enum.AnimationPriority.Action
	end

	stopFlagReverseBang.Value = not reverseBangOn
	if reverseBangOn then
		loopReverseBangAnimation(trackReverseBang, 0.5, 0.5, 0.65, stopFlagReverseBang)
	end
	playSound("12221967")
end)

-- إعادة تجهيز بانق عكسي بعد الموت
LocalPlayer.CharacterAdded:Connect(function(c)
	character = c
	humanoid = c:WaitForChild("Humanoid")
	trackReverseBang = nil -- إعادة التحميل عند الموت

	if reverseBangOn then
		local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)
		local anim = Instance.new("Animation")
		anim.AnimationId = "rbxassetid://122458935180603" -- نفس ID
		trackReverseBang = animator:LoadAnimation(anim)
		trackReverseBang.Priority = Enum.AnimationPriority.Action

		stopFlagReverseBang.Value = false
		loopReverseBangAnimation(trackReverseBang, 0.5, 0.5, 0.65, stopFlagReverseBang)
	end
end)

-- ================= مانع مص =================
local noSuckEnabled = false
local noSuckAnimId = "rbxassetid://83493759980563"
local function setupNoSuckAnim()
	if not humanoid then return end
	if noSuckTrack then noSuckTrack:Stop() end
	local anim = Instance.new("Animation")
	anim.AnimationId = noSuckAnimId
	local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)
	noSuckTrack = animator:LoadAnimation(anim)
	noSuckTrack.Priority = Enum.AnimationPriority.Action
end

ToggleNoSuck.MouseButton1Click:Connect(function()
	noSuckEnabled = not noSuckEnabled
	ToggleNoSuck.Text = "مانـع مـص | "..(noSuckEnabled and "ON" or "OFF")
	ToggleNoSuck.BackgroundColor3 = noSuckEnabled and Color3.fromRGB(160,60,60) or Color3.fromRGB(0,170,255)
	if noSuckEnabled then setupNoSuckAnim() noSuckTrack:Play() noSuckTrack.TimePosition = 0
	elseif noSuckTrack then noSuckTrack:Stop() end
	playSound("12221967")
end)

-- ================= مص عكسي =================
local reverseSuckEnabled = false
local reverseSuckAnimId = "rbxassetid://87140791839062"
local function setupReverseSuckAnim()
	if not humanoid then return end
	if reverseSuckTrack then reverseSuckTrack:Stop() end
	local anim = Instance.new("Animation")
	anim.AnimationId = reverseSuckAnimId
	local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)
	reverseSuckTrack = animator:LoadAnimation(anim)
	reverseSuckTrack.Priority = Enum.AnimationPriority.Action
end

ToggleReverseSuck.MouseButton1Click:Connect(function()
	reverseSuckEnabled = not reverseSuckEnabled
	ToggleReverseSuck.Text = "مـص عكـسي | "..(reverseSuckEnabled and "ON" or "OFF")
	ToggleReverseSuck.BackgroundColor3 = reverseSuckEnabled and Color3.fromRGB(160,60,60) or Color3.fromRGB(0,170,255)
	if reverseSuckEnabled then setupReverseSuckAnim() reverseSuckTrack:Play() reverseSuckTrack.TimePosition = 0
	elseif reverseSuckTrack then reverseSuckTrack:Stop() end
	playSound("12221967")
end)

-- ================= مانع جلخ (النظام الجديد) =================

local grindEnabled = false
local grindTrack

local GRIND_SETTINGS = {
	AnimationId = 87058607990254,
	Speed = 1,
	StartTime = 0.8,
	FreezeAt = 0.8,
}

-- تحديث الشخصية عند الانضمام أو Respawn
local function setupGrindCharacter(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")

	if grindTrack then
		pcall(function() grindTrack:Stop() end)
		grindTrack = nil
	end
end

if LocalPlayer.Character then
	setupGrindCharacter(LocalPlayer.Character)
end
LocalPlayer.CharacterAdded:Connect(setupGrindCharacter)

-- تشغيل الأنميشن
local function playGrindAnimation()
	if not humanoid or humanoid.Health <= 0 then return end

	if grindTrack then
		grindTrack:Stop()
		grindTrack = nil
	end

	local anim = Instance.new("Animation")
	anim.AnimationId = "rbxassetid://" .. GRIND_SETTINGS.AnimationId

	local animator = humanoid:FindFirstChildOfClass("Animator")
	if not animator then
		animator = Instance.new("Animator", humanoid)
	end

	local track = animator:LoadAnimation(anim)
	track.Priority = Enum.AnimationPriority.Action4
	track:Play(0, 1, GRIND_SETTINGS.Speed)

	if GRIND_SETTINGS.StartTime > 0 then
		track.TimePosition = GRIND_SETTINGS.StartTime
	end

	-- تجميد عند الوقت المحدد
	task.spawn(function()
		while track.IsPlaying do
			task.wait()
			if GRIND_SETTINGS.FreezeAt > 0 and track.TimePosition >= GRIND_SETTINGS.FreezeAt then
				track:AdjustSpeed(0)
				break
			end
		end
	end)

	grindTrack = track
end

-- إيقاف الأنميشن
local function stopGrindAnimation()
	if grindTrack then
		grindTrack:Stop()
		grindTrack = nil
	end
end

-- ربطه بزر الـ GUI
ToggleNoGrind.MouseButton1Click:Connect(function()
	grindEnabled = not grindEnabled

	ToggleNoGrind.Text = "مانـع جلخ | "..(grindEnabled and "ON" or "OFF")
	ToggleNoGrind.BackgroundColor3 =
		grindEnabled and Color3.fromRGB(160,60,60) or Color3.fromRGB(0,170,255)

	if grindEnabled then
		playGrindAnimation()
	else
		stopGrindAnimation()
	end

	playSound("12221967")
end)

-- ================= إعادة تهيئة عند تغيير الشخصية =================
LocalPlayer.CharacterAdded:Connect(function(c)
	setupChar(c)
	setupNoSuckAnim()
	setupReverseSuckAnim()
	setupNoGrindAnim()
end)
